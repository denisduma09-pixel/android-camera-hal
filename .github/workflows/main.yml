name: Build Camera HAL

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup NDK
      run: |
        wget -q https://dl.google.com/android/repository/android-ndk-r25b-linux.zip
        unzip -q android-ndk-r25b-linux.zip

    - name: Create HAL source
      run: |
        cat > hal.cpp << 'EOF'
#include <android/log.h>

__attribute__((visibility("default")))
void camera_hal_init() {
    __android_log_write(3, "CameraHAL", "HAL loaded");
}
EOF

    - name: Compile HAL
      run: |
        NDK="$GITHUB_WORKSPACE/android-ndk-r25b"
        $NDK/toolchains/llvm/prebuilt/linux-x86_64/bin/armv7a-linux-androideabi28-clang++ \
        -shared -fPIC -o camera.msm8916.so hal.cpp -llog

    - name: Upload result
      uses: actions/upload-artifact@v4
      with:
        name: camera-hal
        path: camera.msm8916.so
